(function(){var t,e,i,n=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,o=function(t,e){function i(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},s=[].slice;t=window.$,i=window._,e=window.Backbone,function(t,e){"function"==typeof define&&define.amd?define(["backbone","underscore"],e):t.Giraffe=e(t.Backbone,t._)}(this,function(e,i){var r,a,l,p,u,h;if(!i&&!i)throw Error("Can't find underscore");if(!e&&!e)throw Error("Can't find Backbone");return e.Giraffe=l={version:"0.2.6",app:null,apps:{},views:{}},a=t(window),r=t(document),l.View=function(e){function a(t){this.render=n(this.render,this),l.configure(this,t),this.children=[],this.parent=null,this._renderedOnce=!1,this._isAttached=!1,this._createEventsFromUIElements(),"string"==typeof this.templateStrategy&&l.View.setTemplateStrategy(this.templateStrategy,this),a.__super__.constructor.apply(this,arguments)}return o(a,e),a.defaultOptions={disposeOnDetach:!0},a.prototype._beforeInitialize=function(){return this._cache(),this.$el.attr("data-view-cid",this.cid),this.setParent(l.View.getClosestView(this.$el)),this._cacheUiElements()},a.prototype._attachMethods=["append","prepend","html","after","before","insertAfter","insertBefore"],a.prototype._siblingAttachMethods=["after","before","insertAfter","insertBefore"],a.prototype.attachTo=function(t,e){var n,r,o,s,a,p;if(s=(null!=e?e.method:void 0)||"append",o=(null!=e?e.forceRender:void 0)||!1,p=(null!=e?e.suppressRender:void 0)||!1,!this.$el)throw Error("Trying to attach a disposed view. Make a new one or create the view with the option `disposeOnDetach` set to false.");if(!i.contains(this._attachMethods,s))throw Error("The attach method '"+s+"' isn't supported - must be one of ["+this._attachMethods+"].");if(r=l.View.to$El(t),1!==r.length)throw Error("Expected to attach to a single element but found "+r.length+" elements");return this.trigger("attaching",this,r,e),n=i.contains(this._siblingAttachMethods,s)?r.parent():r,"insertAfter"===s&&(s="after"),"insertBefore"===s&&(s="before"),this.detach(!0),this.setParent(l.View.getClosestView(n)),"html"===s&&(l.View.detachByEl(r),r.empty()),r[s](this.$el),this._isAttached=!0,a=!p&&(!this._renderedOnce||o||this.alwaysRender),a&&this.render(e),this.saveScrollPosition&&this._loadScrollPosition(),null!=this.documentTitle&&(document.title=this.documentTitle),this.trigger("attached",this,r,e),this},a.prototype.attach=function(t,e){var i,n;if(n=null,null!=e?e.el:void 0){if(i=l.View.to$El(e.el,this.$el,!0),!i.length)throw Error("Attempting to attach to an element that doesn't exist inside this view!");n=i}else n=this.$el;return t.attachTo(n,e),this},a.prototype.render=function(t){var e;return this.trigger("rendering",this,t),this.beforeRender.apply(this,arguments),this._renderedOnce=!0,this.detachChildren(null!=t?t.preserve:void 0),e=this.templateStrategy.apply(this,arguments)||"",this.$el.empty()[0].innerHTML=e,this._cacheUiElements(),this.afterRender.apply(this,arguments),this.trigger("rendered",this,t),this},a.prototype.beforeRender=function(){},a.prototype.afterRender=function(){},a.prototype.templateStrategy=function(){return""},a.prototype.template=null,a.prototype.serialize=function(){return this},a.prototype.detach=function(t){return null==t&&(t=!1),this._isAttached?(this._isAttached=!1,this.saveScrollPosition&&this._saveScrollPosition(),this.trigger("detaching",this,t),this.$el.detach(),this.trigger("detached",this,t),this.disposeOnDetach&&!t&&this.dispose(),this):this},a.prototype.detachChildren=function(t){var e,i,n,r;for(null==t&&(t=!1),r=this.children.slice(),i=0,n=r.length;n>i;i++)e=r[i],"function"==typeof e.detach&&e.detach(t);return this},a.prototype._saveScrollPosition=function(){return this._scrollPosition=this._getScrollPositionEl().scrollTop(),this},a.prototype._loadScrollPosition=function(){return null!=this._scrollPosition&&this._getScrollPositionEl().scrollTop(this._scrollPosition),this},a.prototype._getScrollPositionEl=function(){var t;return"boolean"==typeof this.saveScrollPosition||this.$el.is(this.saveScrollPosition)?this.$el:(t=l.View.to$El(this.saveScrollPosition,this.$el).first(),t.length?t:(t=l.View.to$El(this.saveScrollPosition).first(),t.length?t:this.$el))},a.prototype.addChild=function(t){var e;return i.contains(this.children,t)||(null!=(e=t.parent)&&e.removeChild(t,!0),t.parent=this,this.children.push(t)),this},a.prototype.addChildren=function(t){var e,i,n;for(i=0,n=t.length;n>i;i++)e=t[i],this.addChild(e);return this},a.prototype.removeChild=function(t,e){var n;return null==e&&(e=!1),n=i.indexOf(this.children,t),-1!==n&&(this.children.splice(n,1),t.parent=null,e?"function"==typeof t.detach&&t.detach(!0):"function"==typeof t.dispose&&t.dispose()),this},a.prototype.removeChildren=function(t){var e,i,n,r;for(null==t&&(t=!1),r=this.children.slice(),i=0,n=r.length;n>i;i++)e=r[i],this.removeChild(e,t);return this},a.prototype.setParent=function(t){return t&&t!==this?t.addChild(this):this.parent&&(this.parent.removeChild(this,!0),this.parent=null),this},a.prototype.isAttached=function(t){return null!=t?t.$el?!!t.$el.find(this.$el).length:this.$el.parent().is(t):!!r.find(this.$el).length},a.prototype.ui=null,a.prototype._cacheUiElements=function(){var t,e,i;if(this.ui){i=this.ui;for(t in i)e=i[t],this[t]=function(){switch(typeof e){case"string":return this.$(e);case"function":return e.call(this);default:return e}}.call(this)}return this},a.prototype._uncacheUiElements=function(){var t;if(this.ui)for(t in this.ui)delete this[t];return this},a.prototype._createEventsFromUIElements=function(){var t,e,i,n;if(!this.events||!this.ui)return this;"function"==typeof this.ui&&(this.ui=this.ui.call(this)),"function"==typeof this.events&&(this.events=this.events.call(this)),n=this.events;for(t in n)e=n[t],i=this._getEventKeyFromUIElements(t),i!==t&&(delete this.events[t],this.events[i]=e);return this},a.prototype._getEventKeyFromUIElements=function(t){var e,i,n,r;return n=t.split(" "),i=n.length,2>i?t:(e=n[i-1],r=this.ui[e],r?(n[i-1]=r,n.join(" ")):t)},a.prototype.dataEvents=null,a.prototype._uncache=function(){return delete l.views[this.cid],this},a.prototype._cache=function(){return l.views[this.cid]=this,this},a.prototype.invoke=function(){var t,e,i;for(e=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],i=this;i&&!i[e];)i=i.parent;if("function"==typeof(null!=i?i[e]:void 0))return i[e].apply(i,t);throw Error("No such method name in view hierarchy '"+e+"'")},a.prototype.appEvents=null,a.prototype._dispose=function(){if(this.setParent(null),this.removeChildren(),this._uncacheUiElements(),this._uncache(),this._isAttached=!1,!this.$el)throw Error("Disposed of a view that has already been disposed");return this.remove(),this.$el=null,this},a.prototype.beforeDispose=function(){},a.prototype.afterDispose=function(){},a.prototype.beforeInitialize=function(){},a.prototype.afterInitialize=function(){},a.detachByEl=function(t,e){var i,n,r,o;for(null==e&&(e=!1),n=l.View.to$El(t);(i=n.find("[data-view-cid]:first")).length;)r=i.attr("data-view-cid"),o=l.View.getByCid(r),o.detach(e);return this},a.getClosestView=function(t){var e,i;return e=l.View.to$El(t),i=e.closest("[data-view-cid]").attr("data-view-cid"),l.View.getByCid(i)},a.getByCid=function(t){return l.views[t]},a.to$El=function(e,i,n){var r;return null==n&&(n=!1),i?(r=l.View.to$El(i),(null!=e?e.$el:void 0)&&(e=e.$el),n&&r.is(e)?r:r.find(e)):(null!=e?e.$el:void 0)?e.$el:e instanceof t?e:t(e)},a.setDocumentEvents=function(e,n){var o,s,a,p,u,h;for(null==n&&(n=l.View._documentEventPrefix),n=n||"","string"==typeof e&&(e=e.split(" ")),i.isArray(e)||(e=[e]),e=i.compact(e),l.View.removeDocumentEvents(),l.View._currentDocumentEvents=e,l.View._documentEventPrefix=n,p=function(e,i,n){return r.on(e,n,function(e){var r,o,s;return r=t(e.target).closest(n),o=r.attr(i),s=l.View.getClosestView(r),s.invoke(o,e)})},u=0,h=e.length;h>u;u++)s=e[u],o=n+s,a="["+o+"]",p(s,o,a);return e},a.removeDocumentEvents=function(t){var e,i,n,o,s;if(null==t&&(t=l.View._documentEventPrefix),t=t||"",e=l.View._currentDocumentEvents,null!=e?e.length:void 0){for(o=0,s=e.length;s>o;o++)i=e[o],n="["+t+i+"]",r.off(i,n);return l.View._currentDocumentEvents=null}},a.setDocumentEventPrefix=function(t){return null==t&&(t=""),l.View.setDocumentEvents(l.View._currentDocumentEvents,t)},a.setTemplateStrategy=function(e,n){var r,o;if(r=typeof e,"function"===r)o=e;else{if("string"!==r)throw Error("Unrecognized template strategy '"+e+"'");switch(e.toLowerCase()){case"underscore-template-selector":o=function(){var e,n=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":e=this.template,this._templateFn=i.template(t(e).html()||"");break;case"function":this._templateFn=function(r){return e=n.template(),i.template(t(e).html()||"",r)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"underscore-template":o=function(){var t=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":this._templateFn=i.template(this.template);break;case"function":this._templateFn=function(e){return i.template(t.template(),e)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"jst":o=function(){var t;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":t=this.template,this._templateFn=function(){return t};break;case"function":this._templateFn=this.template;break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;default:throw Error("Unrecognized template strategy: "+e)}}return n?n.templateStrategy=o:l.View.prototype.templateStrategy=o},a}(e.View),l.View.setTemplateStrategy("underscore-template-selector"),l.View.setDocumentEvents(["click","change"],"data-gf-"),l.App=function(t){function e(){this._onUnload=n(this._onUnload,this),this.app=this,this._initializers=[],this.started=!1,e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype._cache=function(){return null==l.app&&(l.app=this),l.apps[this.cid]=this,this.routes&&null==this.router&&(this.router=new l.Router({app:this,triggers:this.routes})),a.on("unload",this._onUnload),e.__super__._cache.apply(this,arguments)},e.prototype._uncache=function(){return l.app===this&&(l.app=null),delete l.apps[this.cid],this.router&&(this.router=null),a.off("unload",this._onUnload),e.__super__._uncache.apply(this,arguments)},e.prototype._onUnload=function(){return this.dispose()},e.prototype.appEvents=null,e.prototype.routes=null,e.prototype.addInitializer=function(t){return this.started?(t.call(this,this._startOptions),i.extend(this,this._startOptions)):this._initializers.push(t),this},e.prototype.start=function(t){var e,n=this;return null==t&&(t={}),this._startOptions=t,this.trigger("app:initializing",t),e=function(r){var o;if(r)throw Error(r);return o=n._initializers.shift(),o?2===o.length?o.call(n,t,e):(o.call(n,t),e()):(i.extend(n,t),n.started=!0,n.trigger("app:initialized",t))},e(),this},e}(l.View),l.Router=function(t){function n(t){if(l.configure(this,t),!this.app)throw Error("Giraffe routers require an app! Please create an instance of Giraffe.App before creating a router.");if(this.app.addChild(this),"function"==typeof this.triggers&&(this.triggers=this.triggers.call(this)),!this.triggers)throw Error("Giraffe routers require a `triggers` map of routes to app events.");this._routes={},this._bindTriggers(),n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.namespace="",n.prototype._fullNamespace=function(){return this.parentRouter?this.parentRouter._fullNamespace()+"/"+this.namespace:this.namespace},n.prototype.triggers=null,n.prototype._bindTriggers=function(){var t,e,i,n,r,o=this;if(!this.triggers)throw Error("Expected router to implement `triggers` hash in the form {route: appEvent}");e=this._fullNamespace(),e.length>0&&(e+="/"),r=this.triggers,n=function(t,e,i){var n;return 0===e.indexOf("-> ")?n=function(){var t;return t=e.slice(3),o.navigate(t,{trigger:!0})}:0===e.indexOf("=> ")?n=function(){var t;return t=e.slice(3),o.navigate(i+t,{trigger:!0})}:(t=i+t,n=function(){var i,n;return i=arguments.length>=1?s.call(arguments,0):[],(n=o.app).trigger.apply(n,[e].concat(s.call(i),[t]))},o._registerRoute(e,t)),o.route(t,e,n)};for(i in r)t=r[i],n(i,t,e);return this},n.prototype._unbindTriggers=function(){var t;return t=this._getTriggerRegExpStrings(),e.history.handlers=i.reject(e.history.handlers,function(e){return i.contains(t,""+e.route)})},n.prototype._getTriggerRegExpStrings=function(){return i.map(i.keys(this.triggers),function(t){return""+e.Router.prototype._routeToRegExp(t)})},n.prototype.cause=function(){var t,n,r,o,a;return n=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],o=this.getRoute.apply(this,[n].concat(s.call(t))),null!=o?(r=t[t.length-1],e.history.navigate(o,i.extend({trigger:!0},i.isObject(r)?r:{}))):(a=this.app).trigger.apply(a,[n].concat(s.call(t)))},n.prototype.isCaused=function(){var t,e,i;return e=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],i=this.getRoute.apply(this,[e].concat(s.call(t))),null!=i?this._getLocation()===i:!1},n.prototype._getLocation=function(){return e.history._hasPushState?window.location.pathname.slice(1):window.location.hash},n.prototype.getRoute=function(){var t,i,n;return i=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],n=this._routes[i],null!=n?(n=this._reverseHash.apply(this,[n].concat(s.call(t))),n?e.history._hasPushState?n:"#"+n:""===n?"":null):null},n.prototype._registerRoute=function(t,e){return this._routes[t]=e},n.prototype._reverseHash=function(){var t,e,n,r,o;return r=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],e=t[0],null==e?r.replace(/\(.+?\)/g,""):(o=/[:|\*]\w+/g,n=i.isObject(e)?r.replace(o,function(t){var i,n;return i=t.slice(1),null!=(n=e[i])?n:""}):r.replace(o,function(){var e;return e=t.shift(),null!=e?e:""}),n=n.replace(/\(.+\)/g,function(t){return t.match(/\w+/g)?t.replace(/\(|\)/g,""):""}))},n.prototype.reload=function(t){return t&&(e.history.stop(),window.location=t),window.location.reload()},n.prototype.appEvents=null,n.prototype._dispose=function(){return this._unbindTriggers()},n}(e.Router),l.Model=function(t){function e(t,i){l.configure(this,i),e.__super__.constructor.apply(this,arguments)}return o(e,t),e.defaultOptions={omittedOptions:"parse"},e.prototype.appEvents=null,e.prototype._dispose=function(){var t;return null!=(t=this.collection)?t.remove(this):void 0},e}(e.Model),l.Collection=function(t){function e(t,i){l.configure(this,i),e.__super__.constructor.apply(this,arguments)}return o(e,t),e.defaultOptions={omittedOptions:"parse"},e.prototype.model=l.Model,e.prototype.appEvents=null,e.prototype._dispose=function(){var t,e,i,n;for(n=this.models.slice(),e=0,i=n.length;i>e;e++)t=n[e],t.dispose();return this},e.prototype._removeReference=function(t){return e.__super__._removeReference.apply(this,arguments),t._disposed?void 0:"function"==typeof t.dispose?t.dispose():void 0},e}(e.Collection),l.configure=function(t,e){var n,r,o,s;if(!i.isObject(t))throw Error("Giraffe.configure requires an object as the first parameter");return r=i.extend({},l.defaultOptions,null!=(o=t.constructor)?o.defaultOptions:void 0,t.defaultOptions,e),n=null!=(s=r.omittedOptions)?s:t.omittedOptions,n!==!0&&i.extend(t,i.omit(r,n)),null==t.dispose&&(t.dispose=l.dispose),null==t.app&&(t.app=l.app),t.appEvents&&l.bindAppEvents(t),t.initialize?l.wrapFn(t,"initialize",t._beforeInitialize,p):p.call(t),t},l.defaultOptions={},p=function(){return this.dataEvents?l.bindDataEvents(this):void 0},l.dispose=function(){var t;return t=arguments.length>=1?s.call(arguments,0):[],"function"==typeof this.trigger&&this.trigger.apply(this,["disposing",this].concat(s.call(t))),"function"==typeof this.beforeDispose&&this.beforeDispose.apply(this,t),this._disposed=!0,"function"==typeof this._dispose&&this._dispose.apply(this,t),this.app=null,"function"==typeof this.stopListening&&this.stopListening(),"function"==typeof this.trigger&&this.trigger.apply(this,["disposed",this].concat(s.call(t))),"function"==typeof this.afterDispose&&this.afterDispose.apply(this,t),this},l.bindAppEvents=function(t){return l.bindEventMap(t,t.app,t.appEvents)},l.bindDataEvents=function(t){var e,i,n,r,o,s;if(i=t.dataEvents){"function"==typeof i&&(i=t.dataEvents());for(n in i){if(e=i[n],o=n.split(" "),2>o.length)throw Error("Data event must specify target object, ex: {'change collection': 'handler'}");if(s=o.pop(),s="this"===s||"@"===s?t:t[s],!s)throw Error("Target object not found for data event '"+n+"'");r=o.join(" "),l.bindEvent(t,s,r,e)}return t}},l.bindEvent=function(){var t;return t=arguments.length>=1?s.call(arguments,0):[],t.push("listenTo"),u.apply(null,t)},l.unbindEvent=function(){var t;return t=arguments.length>=1?s.call(arguments,0):[],t.push("stopListening"),u.apply(null,t)},l.bindEventMap=function(){var t;return t=arguments.length>=1?s.call(arguments,0):[],t.push("listenTo"),h.apply(null,t)},l.unbindEventMap=function(){var t;return t=arguments.length>=1?s.call(arguments,0):[],t.push("stopListening"),h.apply(null,t)},u=function(t,e,i,n,r){if("string"==typeof n&&(n=t[n]),"function"!=typeof n)throw Error("callback for `'"+i+"'` not found");return t[r](e,i,n)},h=function(t,e,i,n){var r,o;if("function"==typeof i&&(i=i.call(t)),i){for(o in i)r=i[o],u(t,e,o,r,n);return t}},l.wrapFn=function(t,e,i,n){var r,o;return o=t[e],"function"==typeof o?(r=e[0].toUpperCase()+e.slice(1),t[e]=function(){var e,a,l,p;return e=arguments.length>=1?s.call(arguments,0):[],null!=i&&i.apply(t,e),"function"==typeof t[l="before"+r]&&t[l].apply(t,e),a=o.apply(t,e),"function"==typeof t[p="after"+r]&&t[p].apply(t,e),null!=n&&n.apply(t,e),a}):void 0},l})}).call(this);